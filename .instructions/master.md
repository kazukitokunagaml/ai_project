# AI Master Instructions

## 行動原則

- **外科的変更**: 依頼された箇所だけを直せ。周辺コードの改善・リファクタリング・フォーマット修正はするな
- **最小主義**: 要求されていない抽象化・ヘルパー関数・拡張性を入れるな
- **押し戻し**: より単純な方法があるなら提案せよ
- **変更前に計画を示せ**: 大きな変更は実装前に方針を提示し承認を得よ

## 技術スタック

> **自己更新**: 実態と乖離していたら作業中に更新せよ。信頼できる情報源は `pyproject.toml` と実際のコード。

| カテゴリ | 技術 |
|---|---|
| 言語 | Python 3.12+ |
| パッケージマネージャ | uv |
| テスト | pytest |
| リンター/フォーマッター | ruff |

## コマンド

> **自己更新**: コマンドが動かなかった場合、正しいコマンドを確認してここを修正せよ。

```bash
uv run pytest -v            # テスト
uv run ruff check .         # リント
uv run ruff format .        # フォーマット
```

## 境界条件

**確認不要で実行してよい**: リント、フォーマット、テスト実行

**実行前にユーザーに確認せよ**:
- 新しい外部ライブラリの導入
- DBスキーマの変更
- アーキテクチャに影響する設計変更

**禁止**: `.env`・認証情報のコミット / `main` への直接プッシュ / `force push` / パスしているテストの削除

## セッション管理

- セッションが長くなり文脈が溢れそうな場合、`HANDOFF.md` を作成し次のセッションへ引き継げ
- 有用な知見が得られたら `LEARNINGS.md` に追記せよ
- `HANDOFF.md` の内容を引き継いだセッションは、完了後に `HANDOFF.md` を削除せよ

## ドキュメント自己更新プロトコル

これらのドキュメントは「生きた文書」である。以下の条件に該当したとき、**作業の一部として**該当ドキュメントを更新せよ。

| トリガー | 更新対象 | 更新内容 |
|---|---|---|
| `pyproject.toml` に依存を追加/削除した | `master.md` 技術スタック | ライブラリ一覧の同期 |
| コマンドが失敗した・変わった | `master.md` コマンド | 正しいコマンドに修正 |
| 新しいディレクトリを作成した | `rules.md` ディレクトリ構成 | 実構成に同期 |
| プロジェクト固有の技術選択をした | `rules.md` | 選択内容と理由を追記 |
| ハマった・想定外の挙動に遭遇した | `LEARNINGS.md` | 教訓を追記 |
| 既存ルールが実態と矛盾している | 該当ファイル | 実態に合わせて修正 |
